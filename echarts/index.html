<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>CocosCreator Performance Test</title>
    <!-- 引入 echarts.js -->
    <script src="echarts.min.js"></script>
    <script src="jquery-3.2.1.min.js"></script>
</head>

<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="OSX_chart" style="width: 600px;height:400px;"></div>
    <div id="Windows_chart" style="width: 600px;height:400px;"></div>
    <div id="iOS_chart" style="width: 600px;height:400px;"></div>
    <div id="Android_chart" style="width: 600px;height:400px;"></div>
    <script type="text/javascript">
        var i = 0;
        var platforms = ["OS X", "Windows", "iOS", "Android"];
        // 基于准备好的dom，初始化echarts实例
        var charts = [];
        for (i = 0; i < platforms.length; i++) {
            charts.push(echarts.init(document.getElementById(platforms[i].replace(/\s+/g, "") + "_chart")));
        }

        // 指定图表的配置项和数据
        for (i = 0; i < charts.length; i++) {
            var option = {
                title: {
                    text: "CocosCreator Performance Test" + "(" + platforms[i] + ")"
                },
                tooltip: {},
                legend: {
                    data: []
                },
                xAxis: {
                    data: []
                },
                yAxis: {
                    max: 60,
                    min: 0
                },
                series: []
            };

            // 使用刚指定的配置项和数据显示图表。
            charts[i].setOption(option);
            charts[i].showLoading();
        }

        $.post("http://localhost:30000/get_result").done(function (data) {
            data = [{"platform":"OS X","time":1516264431454,"data":[null,{"name":"Bunny Test(iPhone 6, Safari, 2600)","maxTime":14,"minTime":0,"avgFps":"60"},{"name":"Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":8,"minTime":0,"avgFps":"60"},null,{"name":"Prefab Bunny Test(iPhone 6, Safari, 2600)","maxTime":9,"minTime":0,"avgFps":"60"},{"name":"Prefab Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":8,"minTime":0,"avgFps":"60"},{"name":"Bunny Add / Remove Test","maxTime":44,"minTime":0,"avgFps":"59"},{"name":"Bunny Tree Test","maxTime":19,"minTime":0,"avgFps":"60"},{"name":"Bunny Active / Inactive Test","maxTime":18,"minTime":0,"avgFps":"60"},{"name":"Bunny Transform Animation Test","maxTime":13,"minTime":0,"avgFps":"60"},{"name":"Bunny Frame Animation Test","maxTime":8,"minTime":0,"avgFps":"60"},{"name":"Bunny Transform Action Test","maxTime":14,"minTime":0,"avgFps":"60"}]},{"platform":"iOS","time":1516269854539,"data":[null,{"name":"Bunny Test(iPhone 6, Safari, 2600)","maxTime":39,"minTime":0,"avgFps":"50"},null,null,{"name":"Prefab Bunny Test(iPhone 6, Safari, 2600)","maxTime":35,"minTime":0,"avgFps":"42"},null,{"name":"Bunny Add / Remove Test","maxTime":40,"minTime":0,"avgFps":"43"},{"name":"Bunny Tree Test","maxTime":41,"minTime":0,"avgFps":"34"},{"name":"Bunny Active / Inactive Test","maxTime":29,"minTime":0,"avgFps":"45"},{"name":"Bunny Transform Animation Test","maxTime":46,"minTime":0,"avgFps":"32"},{"name":"Bunny Frame Animation Test","maxTime":30,"minTime":0,"avgFps":"60"},{"name":"Bunny Transform Action Test","maxTime":61,"minTime":0,"avgFps":"30"}]},{"platform":"Android","time":1516269856638,"data":[null,null,{"name":"Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":52,"minTime":0,"avgFps":"28"},null,null,{"name":"Prefab Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":130,"minTime":0,"avgFps":"24"},{"name":"Bunny Add / Remove Test","maxTime":482,"minTime":0,"avgFps":"3"},{"name":"Bunny Tree Test","maxTime":342,"minTime":0,"avgFps":"11"},{"name":"Bunny Active / Inactive Test","maxTime":135,"minTime":0,"avgFps":"19"},{"name":"Bunny Transform Animation Test","maxTime":226,"minTime":0,"avgFps":"10"},{"name":"Bunny Frame Animation Test","maxTime":109,"minTime":0,"avgFps":"36"},{"name":"Bunny Transform Action Test","maxTime":157,"minTime":0,"avgFps":"12"}]},{"platform":"OS X","time":1516269853091,"data":[null,{"name":"Bunny Test(iPhone 6, Safari, 2600)","maxTime":12,"minTime":0,"avgFps":"60"},{"name":"Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":6,"minTime":0,"avgFps":"60"},null,{"name":"Prefab Bunny Test(iPhone 6, Safari, 2600)","maxTime":9,"minTime":0,"avgFps":"60"},{"name":"Prefab Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":7,"minTime":0,"avgFps":"60"},{"name":"Bunny Add / Remove Test","maxTime":34,"minTime":0,"avgFps":"60"},{"name":"Bunny Tree Test","maxTime":12,"minTime":0,"avgFps":"60"},{"name":"Bunny Active / Inactive Test","maxTime":12,"minTime":0,"avgFps":"60"},{"name":"Bunny Transform Animation Test","maxTime":11,"minTime":0,"avgFps":"60"},{"name":"Bunny Frame Animation Test","maxTime":8,"minTime":0,"avgFps":"60"},{"name":"Bunny Transform Action Test","maxTime":13,"minTime":0,"avgFps":"60"}]},{"platform":"iOS","time":1516270003979,"data":[null,{"name":"Bunny Test(iPhone 6, Safari, 2600)","maxTime":38,"minTime":0,"avgFps":"40"},null,null,{"name":"Prefab Bunny Test(iPhone 6, Safari, 2600)","maxTime":36,"minTime":0,"avgFps":"40"},null,{"name":"Bunny Add / Remove Test","maxTime":88,"minTime":0,"avgFps":"40"},{"name":"Bunny Tree Test","maxTime":49,"minTime":0,"avgFps":"30"},{"name":"Bunny Active / Inactive Test","maxTime":33,"minTime":0,"avgFps":"43"},{"name":"Bunny Transform Animation Test","maxTime":46,"minTime":0,"avgFps":"33"},{"name":"Bunny Frame Animation Test","maxTime":21,"minTime":0,"avgFps":"60"},{"name":"Bunny Transform Action Test","maxTime":47,"minTime":0,"avgFps":"30"}]},{"platform":"Android","time":1516270003698,"data":[null,null,{"name":"Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":153,"minTime":0,"avgFps":"23"},null,null,{"name":"Prefab Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":103,"minTime":0,"avgFps":"27"},{"name":"Bunny Add / Remove Test","maxTime":408,"minTime":0,"avgFps":"3"},{"name":"Bunny Tree Test","maxTime":133,"minTime":0,"avgFps":"17"},{"name":"Bunny Active / Inactive Test","maxTime":131,"minTime":0,"avgFps":"20"},{"name":"Bunny Transform Animation Test","maxTime":172,"minTime":0,"avgFps":"13"},{"name":"Bunny Frame Animation Test","maxTime":113,"minTime":0,"avgFps":"33"},{"name":"Bunny Transform Action Test","maxTime":148,"minTime":0,"avgFps":"15"}]},{"platform":"OS X","time":1516270007412,"data":[null,{"name":"Bunny Test(iPhone 6, Safari, 2600)","maxTime":10,"minTime":0,"avgFps":"60"},{"name":"Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":7,"minTime":0,"avgFps":"60"},null,{"name":"Prefab Bunny Test(iPhone 6, Safari, 2600)","maxTime":10,"minTime":0,"avgFps":"60"},{"name":"Prefab Bunny Test(Vivo Y66, Chrome, 1500)","maxTime":13,"minTime":0,"avgFps":"60"},{"name":"Bunny Add / Remove Test","maxTime":34,"minTime":0,"avgFps":"60"},{"name":"Bunny Tree Test","maxTime":23,"minTime":0,"avgFps":"60"},{"name":"Bunny Active / Inactive Test","maxTime":15,"minTime":0,"avgFps":"60"},{"name":"Bunny Transform Animation Test","maxTime":11,"minTime":0,"avgFps":"60"},{"name":"Bunny Frame Animation Test","maxTime":6,"minTime":0,"avgFps":"60"},{"name":"Bunny Transform Action Test","maxTime":29,"minTime":0,"avgFps":"60"}]}];
            var i, j, k, m, n;
            var platform_data = [];
            var xAxisData = [];
            var seriesData = [];
            var legendsData = [];
            var _data = null;
            var _series = null;
            var time, time_str;
            for (i = 0; i < platforms.length; i++) {
                platform_data[i] = [];
                xAxisData[i] = [];
                seriesData[i] = [];
                legendsData[i] = [];
            }
            for (i = 0; i < data.length; i++) {
                for (j = 0; j < platforms.length; j++) {
                    if (data[i].platform === platforms[j]) {
                        platform_data[j].push(data[i]);
                        break;
                    }
                }
            }
            for (i = 0; i < platform_data.length; i++) {
                platform_data[i].sort((a, b) => { return a.time - b.time; });
            }

            for (i = 0; i < platforms.length; i++) {
                for (j = 0; j < platform_data[i].length; j++) {
                    var time = new Date(platform_data[i][j].time);
                    var time_str = time.getFullYear() + "/" + (time.getMonth() + 1) + "/" + time.getDate();
                    time_str += "\n" + time.getHours() + ":" + time.getMinutes() + ":" + time.getSeconds();
                    xAxisData[i].push(time_str);
                    for (k = 0; k < platform_data[i][j].data.length; k++) {
                        _data = platform_data[i][j].data[k];
                        if (_data && legendsData[i].indexOf(_data.name) === -1) {
                            legendsData[i].push(_data.name);
                            _series = {
                                name: _data.name,
                                data: [],
                                type: "line"
                            }
                            seriesData[i].push(_series);
                        }      
                    }
                }
                for (j = 0; j < platform_data[i].length; j++) {
                    _data = platform_data[i][j];
                    for (k = 0; k < legendsData[i].length; k++) {
                        for (m = 0; m < _data.data.length; m++) {
                            if (_data.data[m] && _data.data[m].name === legendsData[i][k]) {
                               seriesData[i][k].data[j] = _data.data[m].avgFps;
                            }
                        }
                        if (!seriesData[i][k].data[j]) {
                            seriesData[i][k].data[j] = 0;
                        }
                    }
                }
                charts[i].hideLoading();
                charts[i].setOption({
                    title: {
                        text: "CocosCreator Performance Test" + "(" + platforms[i] + ")"
                    },
                    tooltip: {},
                    legend: {
                        data: legendsData[i]
                    },
                    xAxis: {
                        data: xAxisData[i]
                    },
                    yAxis: {
                        max: 60,
                        min: 0
                    },
                    series: seriesData[i]
                });
            }
        });

    </script>
</body>

</html>